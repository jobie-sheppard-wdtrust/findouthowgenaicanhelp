<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Defend against hallucination and bias</title>
  <style>
    :root {
      --background: hsl(220 14% 96%);
      --foreground: hsl(222 47% 11%);
      --card: hsl(0 0% 100%);
      --muted-foreground: hsl(220 9% 46%);
      --border: hsl(220 13% 91%);
      --primary: hsl(217 91% 60%);
      --primary-foreground: hsl(0 0% 100%);
      --draft-bubble-bg: hsl(217 91% 97%);
      --draft-bubble-border: hsl(217 91% 90%);
      --hover-highlight: hsl(217 91% 60% / 0.15);
      --focus-ring: hsl(217 91% 45%);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--background);
      color: var(--foreground);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    :focus-visible {
      outline: 3px solid var(--focus-ring);
      outline-offset: 2px;
      border-radius: 0.25rem;
    }

    .top-header {
      position: fixed;
      inset: 0 0 auto 0;
      height: 3.5rem;
      padding: 0 1.5rem;
      border-bottom: 1px solid var(--border);
      background: var(--card);
      display: flex;
      align-items: center;
      z-index: 10;
    }

    .top-header h1 {
      margin: 0;
      font-size: 1.125rem;
      font-weight: 700;
    }

    .layout {
      margin-top: 3.5rem;
      height: calc(100vh - 3.5rem);
      display: grid;
      grid-template-columns: 1fr 1fr;
      background: var(--background);
    }

    .panel {
      min-height: 0;
      overflow: auto;
      padding: 0.5rem;
    }

    .panel-right {
      border-left: 1px solid var(--border);
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
    }

    .draft-wrap {
      padding: 0.5rem;
    }

    .avatar-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .avatar {
      width: 2rem;
      height: 2rem;
      border-radius: 999px;
      background: #90278e;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 0.9rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .draft-heading {
      margin: 0;
      font-size: 1rem;
    }

    .draft-subtitle {
      margin: 0.1rem 0 0;
      color: var(--muted-foreground);
      font-size: 0.875rem;
    }

    .draft-bubble {
      border-radius: 0.75rem;
      padding: 1rem;
      background: var(--draft-bubble-bg);
      border: 1px solid var(--draft-bubble-border);
    }

    .draft-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 0.75rem;
    }

    .draft-item-btn {
      width: 100%;
      text-align: left;
      border: 0;
      background: transparent;
      border-radius: 0.375rem;
      padding: 0.5rem;
      margin: -0.25rem -0.5rem;
      cursor: pointer;
      color: inherit;
      transition: background-color 0.2s;
      font-size: 0.875rem;
      line-height: 1.4;
    }

    .draft-item-btn:hover {
      background: var(--hover-highlight);
    }

    .draft-item-title {
      margin: 0 0 0.35rem;
      font-size: 0.925rem;
      font-weight: 600;
    }

    .email-shell {
      display: flex;
      flex-direction: column;
      min-height: 100%;
      padding: 0.5rem;
      gap: 0;
    }

    .email-header {
      border-radius: 0.5rem 0.5rem 0 0;
      padding: 1rem;
    }

    .email-header h2 {
      margin: 0 0 1rem;
      font-size: 1rem;
    }

    .meta-row {
      display: grid;
      grid-template-columns: 4.5rem 1fr;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .meta-key { color: var(--muted-foreground); }

    .email-body {
      flex: 1;
      min-height: 10rem;
      border-top: 0;
      padding: 1rem;
    }

    .helper-text {
      margin: 0;
      color: var(--muted-foreground);
      font-size: 0.95rem;
      max-width: 46ch;
    }

    .email-footer {
      border-top: 0;
      border-radius: 0 0 0.5rem 0.5rem;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
    }

    .icon-group {
      display: inline-flex;
      gap: 0.5rem;
    }

    .icon-btn,
    .send-btn {
      border: 1px solid var(--border);
      background: var(--card);
      border-radius: 0.5rem;
      padding: 0.65rem 0.85rem;
      font-size: 0.95rem;
      color: var(--muted-foreground);
    }

    .send-btn {
      padding: 0.75rem 2rem;
      border-color: transparent;
      background: var(--primary);
      color: var(--primary-foreground);
      font-weight: 600;
    }

    .send-btn:disabled,
    .icon-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .context-menu {
      position: fixed;
      min-width: 160px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      box-shadow: 0 15px 30px -12px rgb(0 0 0 / 0.25);
      padding: 0.5rem;
      display: grid;
      gap: 0.5rem;
      z-index: 20;
    }

    .context-menu button {
      border: 0;
      border-radius: 0.375rem;
      background: hsl(220 14% 96%);
      color: inherit;
      text-align: left;
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      cursor: pointer;
    }

    .context-menu button:hover {
      background: var(--hover-highlight);
    }

    [hidden] { display: none !important; }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
        height: auto;
        min-height: calc(100vh - 3.5rem);
      }
      .panel { max-height: none; }
      .panel-right {
        border-left: 0;
        border-top: 1px solid var(--border);
      }
    }
  </style>
</head>
<body>
  <header class="top-header">
    <h1>Being a HITL - defend against hallucination and bias</h1>
  </header>

  <main class="layout" id="main-content">
    <section class="panel panel-left" aria-labelledby="email-heading" role="region">
      <div class="email-shell">
        <div class="card email-header">
          <h2 id="email-heading">New Message</h2>
          <div class="meta-row"><span class="meta-key">To:</span><span>cardiology.referrals@nhs.net</span></div>
          <div class="meta-row"><span class="meta-key">Subject:</span><span>eRS Referral - Cardiology</span></div>
        </div>

        <div class="card email-body" aria-describedby="email-helper">
          <p id="email-helper" class="helper-text">Choose "Copy-paste" or "Check content" from the draft to fill this email.</p>
        </div>

        <div class="card email-footer">
          <div class="icon-group" aria-label="Email toolbar">
            <button class="icon-btn" type="button" disabled aria-label="Attach file">ðŸ“Ž</button>
            <button class="icon-btn" type="button" disabled aria-label="Formatting">âœŽ</button>
          </div>
          <button class="send-btn" type="button" disabled>Send</button>
        </div>
      </div>
    </section>

    <section class="panel panel-right" aria-labelledby="draft-area-heading" role="region">
      <div class="draft-wrap">
        <div class="avatar-row" aria-hidden="true">
          <span class="avatar">AI</span>
          <div>
            <h2 id="draft-area-heading" class="draft-heading">AI Assistant</h2>
            <p class="draft-subtitle">Draft generated</p>
          </div>
        </div>

        <div class="draft-bubble" aria-label="Draft content">
          <ul class="draft-list">
            <li>
              <button class="draft-item-btn" aria-haspopup="menu" aria-expanded="false">
                <h3 class="draft-item-title">1. Opening and reason for referral</h3>
                <span>Dear Cardiology Team, please review this patient for possible arrhythmia after episodes of palpitations.</span>
              </button>
            </li>
            <li>
              <button class="draft-item-btn" aria-haspopup="menu" aria-expanded="false">
                <h3 class="draft-item-title">2. Symptoms summary</h3>
                <span>Symptoms include intermittent palpitations, light-headedness, and occasional exertional breathlessness.</span>
              </button>
            </li>
            <li>
              <button class="draft-item-btn" aria-haspopup="menu" aria-expanded="false">
                <h3 class="draft-item-title">3. Medical details</h3>
                <span>History suggests no known cardiovascular disease and normal blood tests last month.</span>
              </button>
            </li>
            <li>
              <button class="draft-item-btn" aria-haspopup="menu" aria-expanded="false">
                <h3 class="draft-item-title">4. Current medication</h3>
                <span>Currently taking ramipril and atorvastatin. No known drug allergies documented.</span>
              </button>
            </li>
            <li>
              <button class="draft-item-btn" aria-haspopup="menu" aria-expanded="false">
                <h3 class="draft-item-title">5. Requested action</h3>
                <span>Please assess and advise regarding next diagnostic steps and management plan.</span>
              </button>
            </li>
            <li>
              <button class="draft-item-btn" aria-haspopup="menu" aria-expanded="false">
                <h3 class="draft-item-title">6. Email sign-off</h3>
                <span>Kind regards, GP Practice Team.</span>
              </button>
            </li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <div id="context-menu" class="context-menu" role="menu" aria-label="Draft actions" hidden>
    <button type="button" role="menuitem">Copy-paste</button>
    <button type="button" role="menuitem">Check content</button>
  </div>

  <script>
    const buttons = document.querySelectorAll('.draft-item-btn');
    const menu = document.getElementById('context-menu');

    function closeMenu() {
      menu.hidden = true;
      buttons.forEach((btn) => btn.setAttribute('aria-expanded', 'false'));
    }

    function openMenu(targetButton) {
      const rect = targetButton.getBoundingClientRect();
      menu.style.top = `${Math.min(window.innerHeight - 120, rect.bottom + 6)}px`;
      menu.style.left = `${Math.min(window.innerWidth - 180, rect.left)}px`;
      menu.hidden = false;
      buttons.forEach((btn) => btn.setAttribute('aria-expanded', btn === targetButton ? 'true' : 'false'));
      const firstAction = menu.querySelector('button');
      firstAction.focus();
    }

    buttons.forEach((btn) => {
      btn.addEventListener('click', () => {
        if (!menu.hidden && btn.getAttribute('aria-expanded') === 'true') {
          closeMenu();
          return;
        }
        openMenu(btn);
      });

      btn.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          openMenu(btn);
        }
      });
    });

    document.addEventListener('click', (event) => {
      if (!menu.hidden && !menu.contains(event.target) && !event.target.closest('.draft-item-btn')) {
        closeMenu();
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && !menu.hidden) {
        closeMenu();
      }
    });

    menu.querySelectorAll('button').forEach((item) => {
      item.addEventListener('click', closeMenu);
      item.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeMenu();
        }
      });
    });
  </script>
</body>
</html>
